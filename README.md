# 家計アプリ 要件定義書

**バージョン:** 1.0  
**作成日:** 2026年2月5日

---

## 1. 文書概要

| 項目 | 内容 |
|------|------|
| プロジェクト名 | 家計管理アプリケーション |
| 対象ユーザー | 夫婦（2人） |
| 開発フェーズ | MVP（Minimum Viable Product） |
| 目的 | 夫婦間の家計を把握し、柔軟な割り勘機能で精算を効率化する |

---

## 2. システム概要

### 2.1 システム構成

本システムはWebアプリケーションとして構築する。MVP段階ではPC・スマートフォンのブラウザからアクセスするレスポンシブWebアプリとして提供する。2人のユーザー間でリアルタイムにデータを同期し、どちらの端末からも最新の家計情報を確認できる。

### 2.2 技術スタック

| レイヤー | 技術 |
|----------|------|
| フロントエンド | Next.js（React）、TypeScript |
| バックエンド | Next.js API Routes または別途Node.js API |
| データベース | Supabase（PostgreSQL）またはFirebase |
| リアルタイム同期 | Supabase Realtime または Firebase Realtime Database |
| 認証 | Supabase Auth または Firebase Authentication（メール認証） |
| OCR | Tesseract.js（無料OCRライブラリ） |
| ホスティング | Vercel（フロント）＋ Supabase/Firebase（バックエンド） |

---

## 3. 機能要件

### 3.1 ユーザー管理機能

| 機能ID | 機能名 | 説明 |
|--------|--------|------|
| U-001 | ユーザー登録 | メールアドレスとパスワードで新規アカウントを作成する |
| U-002 | ログイン | メールアドレスとパスワードで認証を行う |
| U-003 | ログアウト | 現在のセッションを終了する |
| U-004 | パートナー招待 | 招待リンクまたはコードでパートナーを家計グループに追加する |
| U-005 | プロフィール設定 | 表示名、アイコンなどを設定する |

### 3.2 財布（ウォレット）管理機能

本アプリでは3種類の財布を管理する：ユーザーA個人、ユーザーB個人、そして共通の財布。

| 機能ID | 機能名 | 説明 |
|--------|--------|------|
| W-001 | 財布一覧表示 | 3つの財布（自分・パートナー・共通）の残高を表示する |
| W-002 | 財布切り替え | 入力・表示対象の財布を切り替える |

### 3.3 収入管理機能

収入の登録は必須とする。収入カテゴリは「給与」「副収入（ボーナス等）」の2種類。

| 機能ID | 機能名 | 説明 |
|--------|--------|------|
| I-001 | 収入登録 | 金額、日付、カテゴリ（給与/副収入）、メモを入力して収入を記録する |
| I-002 | 収入編集 | 登録済みの収入を編集する |
| I-003 | 収入削除 | 登録済みの収入を削除する |
| I-004 | 収入一覧 | 指定期間の収入を一覧表示する |

### 3.4 支出管理機能

支出はプリセットカテゴリ8種類（食費、日用品、交通費、光熱費、通信費、娯楽、医療、その他）に加え、ユーザーがカスタムカテゴリを追加できる。

| 機能ID | 機能名 | 説明 |
|--------|--------|------|
| E-001 | 支出登録（手動） | 金額、日付、カテゴリ、店舗名、メモ、対象財布を入力して支出を記録する |
| E-002 | 支出登録（レシート） | レシート画像をOCRで読み取り、合計金額と店舗名を自動入力する |
| E-003 | 支出編集 | 登録済みの支出を編集する |
| E-004 | 支出削除 | 登録済みの支出を削除する |
| E-005 | 支出一覧 | 指定期間の支出を一覧表示する（フィルタリング可） |
| E-006 | カテゴリ管理 | カスタムカテゴリの追加・編集・削除を行う |

### 3.5 割り勘機能

共通支出のみを割り勘対象とする。支出ごとに割合を指定でき、任意のタイミングで精算を実行する。精算は「精算済み」フラグを立てることで完了とする。

| 機能ID | 機能名 | 説明 |
|--------|--------|------|
| S-001 | 割合設定 | 共通支出登録時に負担割合を指定する（例: 60:40、50:50など） |
| S-002 | 精算状況確認 | 未精算の共通支出と各自の負担額を表示する |
| S-003 | 精算実行 | 未精算の支出に対して精算済みフラグを立てる |
| S-004 | 精算履歴 | 過去の精算履歴を確認する |

### 3.6 レポート・分析機能

| 機能ID | 機能名 | 説明 |
|--------|--------|------|
| R-001 | 月別収支一覧 | 月ごとの収入・支出・差額を一覧表示する |
| R-002 | カテゴリ別円グラフ | 指定期間の支出をカテゴリ別に円グラフで表示する |
| R-003 | 推移グラフ | 月ごとの収支推移を折れ線グラフで表示する |
| R-004 | 割り勘精算状況表示 | 現在の精算状況（誰がいくら負担すべきか）をダッシュボードに表示する |

### 3.7 レシートOCR機能

| 機能ID | 機能名 | 説明 |
|--------|--------|------|
| O-001 | 画像アップロード | カメラ撮影またはギャラリーからレシート画像を選択する |
| O-002 | OCR解析 | Tesseract.jsを使用してレシートから合計金額・店舗名を抽出する |
| O-003 | 読取結果確認・修正 | OCR結果を表示し、ユーザーが修正できるようにする |

---

## 4. 非機能要件

### 4.1 性能要件

| 項目 | 要件 |
|------|------|
| 画面応答時間 | 3秒以内（OCR処理を除く） |
| 同時接続数 | 2人（MVP） |
| データ同期遅延 | 5秒以内 |

### 4.2 可用性要件

| 項目 | 要件 |
|------|------|
| 稼働率 | 99%以上（月間ダウンタイム約7時間以内） |
| バックアップ | 日次自動バックアップ |

### 4.3 セキュリティ要件

| 項目 | 要件 |
|------|------|
| 通信暗号化 | HTTPS必須 |
| 認証 | メールアドレス＋パスワード認証 |
| アクセス制御 | 同一家計グループ内のユーザーのみデータアクセス可 |
| パスワード | ハッシュ化して保存 |

### 4.4 保守性要件

| 項目 | 要件 |
|------|------|
| データ保持期間 | 直近3年分 |
| コード管理 | Git（GitHub）でバージョン管理 |
| テスト | 主要機能の単体テスト・結合テスト実施 |

### 4.5 運用コスト

月額数百円程度を許容範囲とする。無料枠のあるサービス（Vercel、Supabase Free Tier等）を優先的に採用し、コストを抑える。

---

## 5. データ要件

### 5.1 主要エンティティ

| エンティティ | 主要属性 |
|--------------|----------|
| User | id, email, password_hash, display_name, avatar_url, created_at |
| Household | id, name, created_at |
| Wallet | id, household_id, owner_id (null=共通), name, type (personal/shared) |
| Income | id, wallet_id, user_id, amount, date, category, memo, created_at |
| Expense | id, wallet_id, user_id, amount, date, category_id, store_name, memo, is_settled, created_at |
| ExpenseShare | id, expense_id, user_id, ratio, amount |
| Category | id, household_id, name, is_preset, icon, color |
| Settlement | id, household_id, settled_at, amount, payer_id, payee_id |

---

## 6. 画面一覧

| 画面ID | 画面名 | 概要 |
|--------|--------|------|
| SC-001 | ログイン画面 | メールアドレスとパスワードを入力してログイン |
| SC-002 | 新規登録画面 | 新規アカウント作成 |
| SC-003 | ダッシュボード | 今月の収支サマリー、精算状況、直近の取引を表示 |
| SC-004 | 収入登録画面 | 収入の新規登録フォーム |
| SC-005 | 支出登録画面 | 支出の新規登録フォーム（手動入力） |
| SC-006 | レシート読取画面 | レシート撮影・アップロード・OCR結果確認 |
| SC-007 | 取引一覧画面 | 収入・支出の履歴一覧（フィルタ・検索機能付き） |
| SC-008 | レポート画面 | 円グラフ・推移グラフの表示 |
| SC-009 | 精算画面 | 未精算一覧と精算実行 |
| SC-010 | 設定画面 | プロフィール編集、カテゴリ管理、パートナー招待 |

---

## 7. 制約事項・前提条件

MVP段階での制約事項と前提条件は以下の通り。

| 項目 | 内容 |
|------|------|
| プラットフォーム | Webアプリのみ（レスポンシブ対応） |
| 参加人数 | 1家計グループあたり最大2人 |
| 対応言語 | 日本語のみ |
| 対応通貨 | 日本円のみ |
| OCR精度 | 無料ライブラリ使用のため精度は保証しない。ユーザーによる確認・修正を前提とする |
| 銀行口座連携 | MVPでは対象外 |
| 通知機能 | MVPでは対象外（将来検討） |

---

## 8. 将来拡張（MVP以降）

将来的な公開を見据え、以下の拡張を検討する。

| 機能 | 概要 |
|------|------|
| 参加人数拡張 | 3人以上の家計グループ対応 |
| PWA/ネイティブアプリ | スマートフォン向けPWAまたはネイティブアプリ化 |
| 予算管理 | カテゴリごとの月間予算設定とアラート |
| 貯蓄目標 | 目標金額の設定と進捗管理 |
| 通知機能 | 精算リマインダー、予算超過アラートなど |
| データエクスポート | CSV/Excel形式でのデータ出力 |
| OCR精度向上 | 有料APIへの切り替えオプション |
| 多言語対応 | 英語などへの対応 |

---

## 9. 用語集

| 用語 | 説明 |
|------|------|
| 家計グループ | データを共有する夫婦（ユーザー）の単位 |
| 財布（ウォレット） | 収入・支出を管理する単位。個人用と共通用がある |
| 割り勘 | 共通支出を指定した割合で分担すること |
| 精算 | 割り勘による負担差額を確定し、清算済みとすること |
| OCR | Optical Character Recognition。画像から文字を認識する技術 |

---

*以上*
