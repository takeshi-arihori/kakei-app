# 要件定義書 (MVP)

## 1. プロジェクト概要
- **目的:** 夫婦間の支出記録と割り勘精算の効率化。
- **ターゲット:** 共働き夫婦（2人）。
- **フェーズ:** MVP (Minimum Viable Product)。

## 2. 機能要件

### A. 認証・オンボーディング
- **メールアドレス認証:** Supabase Authを使用。
- **家計への参加:**
    - 最初のユーザーが「家計」を作成し、「招待コード」を発行。
    - パートナーは招待コードを入力して家計に参加する。
    - **制約:** 1ユーザーにつき1家計のみ所属（MVP）。

### B. 支出管理 (Transactions)
- **記録内容:** 日付、金額（整数）、カテゴリ、支払者（夫or妻）、メモ。
- **3つの財布（概念モデル）:**
    - データ上は「財布」という箱は作らず、以下のフラグで管理する。
    - **個人支出:** \`split_type: PERSONAL\` (負担は支払者100%)
    - **共通支出:** \`split_type: EQUAL\` (負担は50:50) または \`CUSTOM\` (比率指定)
- **レシートOCR:**
    - 画像から合計金額と日付を読み取る。
    - 画像ファイル自体はサーバーに保存しない（プライバシーとコスト配慮）。

### C. 精算 (Settlement)
- **ロジック:**
    - 未精算のトランザクションを集計し、貸借バランス（誰が誰にいくら払うべきか）を算出。
    - 「精算実行」により、精算履歴データを作成し、対象トランザクションを「精算済み」にする。
- **履歴:**
    - 「いつ、誰から誰へ、いくら精算したか」を永続化する。

### D. データ出力
- **CSVダウンロード:**
    - フィルタリングされた期間のデータをCSV形式でエクスポート可能。

## 3. 非機能要件
- **レスポンシブ:** スマホファースト（Tailwind CSS）。
- **パフォーマンス:** Vercel Hobbyプランの制約（Function timeout 10s）を考慮し、OCRはクライアントサイドで処理。
- **セキュリティ:** Supabase RLS (Row Level Security) を全テーブルに適用し、同一家計のメンバー以外はアクセス不可とする。

## 4. 将来の拡張性（今回のスコープ外だが考慮する点）
- 3人以上の家族対応。
- 予算管理機能。
- 定期支払いの自動登録。
